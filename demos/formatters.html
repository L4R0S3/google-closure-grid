<!DOCTYPE html>
<html>
<head>
  <title>Google Closure Grid - pear.ui.Grid</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="../lib/font-awesome-4.0.3/css/font-awesome.min.css" />
  <link rel="stylesheet" href="../lib/closure-library/closure/goog/demos/css/demo.css" />
  <link rel="stylesheet" href="../lib/closure-library/closure/goog/css/checkbox.css">
  
  <link rel="stylesheet" href="../src/css/grid.css" />
  
 
 <style>
  body {
  background-color: white;
  font: normal 10pt Arial, sans-serif;
  }

 </style>
  <script src="../lib/closure-library/closure/goog/base.js"></script>
  <script src="../src/bin/release/pear.grid.js"></script>
  <!--<script src="../src/pear/peardeps.js"></script>-->
  <script>
    goog.require('goog.debug.DivConsole');
    goog.require('goog.debug.LogManager');
    goog.require('goog.dom.forms');
    goog.require('goog.i18n.NumberFormat');
    goog.require('goog.i18n.DateTimeFormat');
    goog.require('goog.ui.Checkbox');

    goog.require('pear.ui.Grid');
    
  </script>

  <style>
    .config-item{
      display: inline-block;
      padding:2px 3px 2px 8px;
      border-color: gray;
      border-width: 0px 0px 0px 0px;
      border-style: solid;
      margin:0px 2px 0px 2px;
      border-radius:3px;
    }
  </style>
</head>
<body>
    <fieldset class="goog-debug-panel">
    <legend>Formatters</legend>
    <div id="">
      <li>Format Data - Currency Formatter , Number Format and Date Format </li>
      <li>Format Header Cell - add Select ALL feature at Header Cell </li>
    </div>
  </fieldset>
  <fieldset class="goog-debug-panel">
    <legend>Data / Debug</legend>
    <div id="">
      <div class="config-item"> Console.dir {events} <input type="checkbox" id="id_consoledir"  /> </div>
      <div class="config-item"> Nos Of Rows : 
          <select id ="id_rows">
             <option value="10">10</option>
             <option value="1000">1000</option>
             <option selected value="10000">10,000</option>
             <option value="50000">50,000</option>
             <option value="100000">100,000</option>
           </select> 
        </div>
    </div>
  </fieldset>
 
  <fieldset class="goog-debug-panel">
    <legend>Action</legend>
    <div id="">
    <input class="config-item" type="button" id="id_reload" value="Reload"  />
  </fieldset>
  <br>
  <!-- This div will have a Sample Component added to its contents. -->
  <div id="target1" style="width:800px;height:500px">
  </div>
  <fieldset class="goog-debug-panel">
    <legend>Event Log</legend>
    <div id="log"></div>
  </fieldset>
  <div id="perf"></div>
</body>

 <script>

    var timer = goog.now();

    // Set up a logger.
    goog.debug.LogManager.getRoot().setLevel(goog.log.Level.ALL);
    var logger = goog.log.getLogger('demo');
    var logconsole = new goog.debug.DivConsole(goog.dom.getElement('log'));
    logconsole.setCapturing(true);

    var GRID_EVENTS = goog.object.getValues(pear.ui.Grid.EventType);
    goog.log.fine(logger, 'Listening for: ' + GRID_EVENTS.join(', ') +'.');

    function logEvent(e) {
      var component = e.target;
      logger.info(' dispatched: ' + e.type);
      if (isChecked('id_consoledir')){
        console.dir(e);
      }
    }

  function isChecked(id,name){
    var elem = goog.dom.getElement(id);
    return  elem.checked;
  };

  function currencyFormatter(gridcell){
    var fmt = new goog.i18n.NumberFormat (goog.i18n.NumberFormat.Format.CURRENCY);
    var text = fmt.format(gridcell.getModel());
    goog.dom.setTextContent(gridcell.getElement(),text);
  };

  function numberFormatter(gridcell){
    var fmt = new goog.i18n.NumberFormat (goog.i18n.NumberFormat.Format.DECIMAL);
    var text = fmt.format(gridcell.getModel());
    goog.dom.setTextContent(gridcell.getElement(),text);
  };

  function dateFormatter(gridcell){
    var fmt = new goog.i18n.DateTimeFormat (goog.i18n.DateTimeFormat.Format.SHORT_DATE);
    var text = fmt.format(gridcell.getModel());

    goog.dom.setTextContent(gridcell.getElement(),text);
  };

  function processedFormatter(gridcell){
    var text = gridcell.getModel();
    var gridrow = gridcell.getRow();
    goog.dom.setTextContent(gridcell.getElement(),'');
    var cb = new goog.ui.Checkbox();
    if (text){
      cb.setChecked(true);
      gridrow.setSelect(true);
    }else{
      cb.setChecked(false);
      gridrow.setSelect(false);
    }
    
    cb.render(gridcell.getElement());

    goog.events.listen(cb,goog.ui.Component.EventType.CHANGE, function(ge){
      
      var cbtarget = ge.target;
      if (cbtarget.isChecked()){
        gridrow.setSelect(true);
      }else{
        gridrow.setSelect(false);
      }
      ge.stopPropagation();
    });
  };

  function createSelectAll (ge){
    var headerCell = ge.cell;
    var grid = headerCell.getGrid();
    var contentCell = headerCell.getContentCell();

    if (headerCell.getColumnId() === "processed"){
      headerCell.clearContent();
      var cb = new goog.ui.Checkbox();
      cb.render(contentCell);

      goog.events.listen(cb,goog.ui.Component.EventType.CHANGE, function(ge){
        var cbtarget = ge.target;
        var ds = grid.getDataRows();
        if (cbtarget.isChecked()){
          goog.array.forEach(ds,function(value){
            value["processed"]=true;
          });
        }else{
          goog.array.forEach(ds,function(value){
            value["processed"]=false;
          });
        }

        grid.setDataRows(ds);
        grid.refresh();

        ge.stopPropagation();
      });
    }
  };

  var item = ['item-0','item-1','item-2','item-3','item-4','item-5','item-6','item-7','item-8','item-9'];
  var unitprice = [1.01,2.25,3.45,4.97,5.0,6.0,7.0,8.2,9.5,10];

  
  var grid;
  var columns = [
    new pear.data.Column("Processed",'processed',95,pear.data.DataTable.DataType.BOOLEAN),
    new pear.data.Column("Order No",'orderno',75,pear.data.DataTable.DataType.NUMBER),
    new pear.data.Column("Item",'item',115,pear.data.DataTable.DataType.TEXT),
    new pear.data.Column("Unit Price",'unitprice',75,pear.data.DataTable.DataType.NUMBER),
    new pear.data.Column("Quantity",'quantity',75,pear.data.DataTable.DataType.NUMBER),
    new pear.data.Column("Total",'total',75,pear.data.DataTable.DataType.NUMBER),
    new pear.data.Column("Created On",'created',95,pear.data.DataTable.DataType.DATETIME)
  ];

  var load = function () {
    if (grid){
      grid.dispose();
    }
    var data = [];
    var limit = goog.dom.forms.getValue(goog.dom.getElement('id_rows'));
    var temp;
    var start = new Date(2013,12,31);
    for (var i = 0; i < parseInt(limit,10); i++) {
      data[i] = {
        orderno:  i +1
      };
      temp = Math.round(Math.random() * 9);
     
      data[i].item = item[temp];
      data[i].unitprice = unitprice[temp];
      data[i].quantity = Math.round(Math.random() * 10000);
      data[i].total = data[i].unitprice * data[i].quantity;
      data[i].processed= (i % 5 === 0);
      data[i].created = new Date(new Date().setDate(new Date().getDate()-Math.round(Math.random() * 365)));
    }

    var start = +new Date();  // log start timestamp


    grid = new pear.ui.Grid();
    var config = {
      AllowColumnResize:true,
      AllowRowHighlight:false
    };
    config = grid.setConfiguration(config);

    grid.setWidth(800);
    grid.setHeight(400);
    grid.setColumns(columns);
    grid.setDataRows(data);

    grid.getColumnById("unitprice").setColumnFormatter(currencyFormatter,this);
    grid.getColumnById("quantity").setColumnFormatter(numberFormatter,this);
    grid.getColumnById("total").setColumnFormatter(currencyFormatter,this);
    grid.getColumnById("created").setColumnFormatter(dateFormatter,this);
    grid.getColumnById("processed").setColumnFormatter(processedFormatter,this);
    
    goog.events.listen(grid, pear.ui.Grid.EventType.AFTER_HEADERCELL_RENDER, createSelectAll);

    grid.render(goog.dom.getElement('target1'));
    var end =  +new Date();  
    var diff = end - start;
    console.log('Load Time : '+diff+'ms');
    
   
    goog.events.listen(grid, GRID_EVENTS, logEvent);
  };

  goog.events.listen(goog.dom.getElement('id_reload'), goog.events.EventType.CLICK, load);

  load();
  
 </script>

</html>
